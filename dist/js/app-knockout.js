var ViewModel=function(){var e=this;this.apartmentList=ko.observableArray([]),this.gamesList=ko.observableArray([]),this.moviesList=ko.observableArray([]),this.parksList=ko.observableArray([]),this.groceriesList=ko.observableArray([]),this.load=function(s,i){i.forEach(function(i){e[s+"List"].push(i)})},ko.extenders.hideMarkers=function(s,i){return s.subscribe(function(s){e.markers.forEach(function(e){e.listingType==i&&e.setMap(s?map:null)})}),s},this.showApartments=ko.observable(!0).extend({hideMarkers:"apartment"}),this.showGames=ko.observable(!0).extend({hideMarkers:"games"}),this.showGroceryStores=ko.observable(!0).extend({hideMarkers:"groceries"}),this.showMovies=ko.observable(!0).extend({hideMarkers:"movies"}),this.showParks=ko.observable(!0).extend({hideMarkers:"parks"}),this.selectedListing={name:ko.observable(),address:ko.observable(),hours:ko.observableArray(),phone:ko.observable(),website:ko.observable(),websiteShort:ko.observable(),photo:ko.observable(),nytArticles:ko.observableArray(),marker:void 0},this.nytRequestStatus=ko.observable(),this.markers=[],this.clearAll=function(){e.apartmentList([]),e.gamesList([]),e.groceriesList([]),e.moviesList([]),e.parksList([]),e.selectedListing.name(void 0),e.selectedListing.address(void 0),e.selectedListing.phone(void 0),e.selectedListing.website(void 0),e.selectedListing.websiteShort(void 0),e.selectedListing.hours(void 0),e.selectedListing.photo(void 0),e.selectedListing.nytArticles([]),e.selectedListing.marker=void 0,e.markers.forEach(function(e){e.setMap(null)}),e.markers.length=0},this.showingListings=ko.observable(!0),this.showingPlaceInfo=ko.observable(!1),this.showingCredits=ko.observable(!1),e.updateInfoPane=function(s){e.selectedListing.name(void 0),e.selectedListing.address(void 0),e.selectedListing.phone(void 0),e.selectedListing.website(void 0),e.selectedListing.websiteShort(void 0),e.selectedListing.hours(void 0),e.selectedListing.photo(void 0),e.selectedListing.nytArticles(void 0);var i;i=void 0!==s.place_id?{placeId:s.place_id}:{placeId:s},new google.maps.places.PlacesService(map).getDetails(i,function(s,i){if(i==google.maps.places.PlacesServiceStatus.OK){if(e.updateInfoPaneArticles(s),e.selectedListing.name(s.name),e.selectedListing.address(s.formatted_address),e.selectedListing.phone(s.formatted_phone_number),s.photos){var t={maxWidth:350,maxHeight:150},o=s.photos[0].getUrl(t);e.selectedListing.photo(o)}else e.selectedListing.photo("img/no-place-preview.jpg");if(s.website){e.selectedListing.website(s.website);var n=s.website;n.startsWith("http://")?n=n.slice(7):n.startsWith("https://")&&(n=n.slice(8)),(n=n.slice(0,n.indexOf("/"))).length>25&&(n=n.slice(0,25),n+="..."),e.selectedListing.websiteShort(n)}s.opening_hours&&e.selectedListing.hours(s.opening_hours.weekday_text)}else e.selectedListing.name("Oops! We couldn't retrieve the place details.")})},e.updateInfoPaneArticles=function(s){e.selectedListing.nytArticles([]),e.nytRequestStatus(void 0);var i=s.name,t="https://api.nytimes.com/svc/search/v2/articlesearch.json";t+="?"+$.param({"api-key":"029a4b3e81e2422d8c8f96d2efb4008b",q:i}),$.ajax({url:t,method:"GET"}).done(function(s){var i=[];"OK"==s.status?(s.response.docs.forEach(function(e){if(e.web_url&&e.headline.main){var s={web_url:e.web_url,headline:e.headline.main};s.headline.length>50&&(s.headline=s.headline.slice(0,50),s.headline+="..."),i.push(s)}}),0==i.length&&e.nytRequestStatus("No related articles were found for this location")):e.nytRequestStatus("The NY Times article request failed because a non OK status was returned"),e.selectedListing.nytArticles(i)}).fail(function(s){e.nytRequestStatus("The request for articles from NY Times failed")})},e.showPlaceInfo=function(s){e.updateInfoPane(s),e.showingListings(!1),e.showingCredits(!1),e.showingPlaceInfo(!0),e.markers.forEach(function(e){e.place_id==s.place_id&&markerCallback(e)}),openMenu()},e.showListings=function(s){e.showingCredits(!1),e.showingPlaceInfo(!1),e.showingListings(!0),unselectMarker()},e.showCredits=function(){e.showingCredits(!e.showingCredits()),e.showingPlaceInfo(!1),e.showingListings(!1),unselectMarker()}};ko.bindingHandlers.fadeVisible={init:function(e,s){var i=s();i=i(),$(e).toggle(i)},update:function(e,s){var i=s();(i=i())?$(e).fadeIn():$(e).fadeOut()}};var viewModel=new ViewModel;ko.applyBindings(viewModel);